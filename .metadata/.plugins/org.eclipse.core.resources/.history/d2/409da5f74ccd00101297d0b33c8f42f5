package com.service;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

import java.time.LocalDateTime;
import java.util.List;

import org.mockito.InjectMocks;
import org.mockito.Mock;

import com.model.Transaction;
import com.repository.TransactionRepository;
import com.service.impl.TransactionService;
import com.util.enums.TransactionStatus;
import com.util.enums.TransactionType;

public class GetAllTransactionsTest {
	
	@Mock
	private TransactionRepository transactionRepository;
	
	@InjectMocks
	private TransactionService transactionService;
	
	private Transaction createTransaction(String id,String accountNumber,String sourceAccount,String destinationAccount,TransactionStatus status,TransactionType transactionType,double amount) {
		Transaction transaction = new Transaction();
		transaction.setAccountNumber(accountNumber);
		transaction.setSourceAccount(sourceAccount);
		transaction.setDestinationAccount(destinationAccount);
		transaction.setAmount(amount);
		transaction.setId(id);
		transaction.setTimestamp(LocalDateTime.now());
		transaction.setStatus(status);
		transaction.setType(transactionType);
		return transaction;
	}
	
	void getAllTransactions_Success() {
		String sourceAccount = "VIK3710";
		String destinationAccount = "ABH7425";
		double amount = 1000;
		String id1 = "6929c62d33103c6a540ca089";
		String id2 = "6929d07733103c6a540ca096";
		String id3 = "6929d0a89ecb7bf278aada70";
		String id4 = "6929d0a89ecb7bf278aada73";
		Transaction t1 = createTransaction(id1,null,sourceAccount,destinationAccount,TransactionStatus.SUCCESS,TransactionType.TRANSFER,amount);
		Transaction t2 = createTransaction(id2, sourceAccount, null, null,TransactionStatus.FAILED,TransactionType.DEPOSIT, amount);
		Transaction t3 = createTransaction(id3, null, destinationAccount, sourceAccount, TransactionStatus.FAILED,TransactionType.TRANSFER, amount);
		Transaction t4 = createTransaction(id4,sourceAccount, null, null, TransactionStatus.SUCCESS,TransactionType.WITHDRAW, amount);
		List<Transaction> transactions = List.of(t1,t2,t3,t4);
		when(transactionRepository.findDistinctByAccountNumberOrSourceAccountOrDestinationAccountOrderByTimestampDesc(sourceAccount, sourceAccount, sourceAccount)).thenReturn(transactions);
		List<Transaction> resultList = transactionService.getAllTransactions(sourceAccount);
		assertEquals(transactions.size(), resultList.size());
		verify(transactionRepository,times(1)).findDistinctByAccountNumberOrSourceAccountOrDestinationAccountOrderByTimestampDesc(sourceAccount, sourceAccount,sourceAccount);
	}
}
